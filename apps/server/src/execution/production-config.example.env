# Production Configuration Template for Shadow Firecracker
# Copy this file to .env and customize for your deployment

# =============================================================================
# EXECUTION MODE CONFIGURATION
# =============================================================================

# Agent execution mode: local or firecracker
# - local: Direct filesystem operations (default for development)
# - firecracker: Hardware-isolated VM execution (production)
AGENT_MODE=firecracker

# =============================================================================
# LOCAL MODE CONFIGURATION
# =============================================================================

# Base directory for task workspaces (local mode only)
WORKSPACE_DIR=/var/lib/shadow/workspaces

# =============================================================================
# FIRECRACKER MODE CONFIGURATION
# =============================================================================

# Enable Firecracker VM mode
FIRECRACKER_ENABLED=true

# VM Image configuration
VM_IMAGE_REGISTRY=your-ecr-registry.amazonaws.com
VM_IMAGE_TAG=latest
FIRECRACKER_KERNEL_PATH=/var/lib/vm-images/vmlinux

# VM Resource configuration
VM_CPU_COUNT=1
VM_MEMORY_SIZE_MB=1024
VM_CPU_LIMIT=1000m
VM_MEMORY_LIMIT=2Gi
VM_STORAGE_LIMIT=10Gi

# Kubernetes cluster configuration
KUBERNETES_NAMESPACE=shadow
K8S_SERVICE_ACCOUNT_TOKEN=your-service-account-token-here

# Storage configuration
EFS_VOLUME_ID=fs-your-efs-volume-id

# =============================================================================
# VM IMAGE BUILD CONFIGURATION
# =============================================================================

# Base image settings
UBUNTU_VERSION=22.04
NODE_VERSION=20
PYTHON_VERSION=3.11
KERNEL_VERSION=5.15.0-91-generic

# Image optimization
VM_IMAGE_SIZE=2G
ROOTFS_COMPRESSION=gzip
KERNEL_COMPRESSION=gzip

# =============================================================================
# KUBERNETES CONFIGURATION
# =============================================================================

# Node requirements
FIRECRACKER_NODE_SELECTOR=firecracker=true
KVM_DEVICE_PATH=/dev/kvm

# Pod configuration
POD_RESTART_POLICY=Never
POD_SERVICE_ACCOUNT=shadow-firecracker-vm-sa
RUNTIME_CLASS=firecracker

# Security context
PRIVILEGED_CONTAINERS=true
REQUIRED_CAPABILITIES=SYS_ADMIN,NET_ADMIN

# Storage classes
WORKSPACE_STORAGE_CLASS=gp3
VM_STORAGE_CLASS=fast-nvme

# Network configuration
CLUSTER_DNS_SUFFIX=cluster.local
VM_NETWORK_POLICY=shadow-vm-isolation

# =============================================================================
# SECURITY CONFIGURATION
# =============================================================================

# GitHub access configuration
GITHUB_TOKEN=your-github-token-here
GITHUB_APP_ID=your-github-app-id
GITHUB_APP_PRIVATE_KEY=your-github-app-private-key

# VM Security settings
JAILER_UID=1000
JAILER_GID=1000
CHROOT_BASE_DIR=/srv/jailer

# Resource limits
VM_FILE_SIZE_LIMIT=134217728  # 128MB
VM_OPEN_FILES_LIMIT=1024
VM_PROCESS_LIMIT=100

# =============================================================================
# MONITORING & LOGGING CONFIGURATION
# =============================================================================

# Log levels: debug, info, warn, error
LOG_LEVEL=info

# Enable detailed VM operation logging
ENABLE_VM_LOGGING=true
ENABLE_CONSOLE_LOGGING=true

# Enable performance metrics
ENABLE_METRICS=true
ENABLE_VM_METRICS=true

# Health check configuration
HEALTH_CHECK_INTERVAL=30000
VM_HEALTH_CHECK_TIMEOUT=5000

# =============================================================================
# PERFORMANCE TUNING
# =============================================================================

# VM boot configuration
VM_BOOT_TIMEOUT=120000        # 2 minutes
SIDECAR_READY_TIMEOUT=60000   # 1 minute
REPOSITORY_CLONE_TIMEOUT=300000  # 5 minutes

# Resource monitoring
MAX_CONCURRENT_VMS=10
MAX_VM_UPTIME_HOURS=24
VM_CLEANUP_INTERVAL=3600000   # 1 hour

# Terminal buffer configuration
TERMINAL_BUFFER_SIZE=10000
TERMINAL_BUFFER_MEMORY_MB=50
TERMINAL_FLUSH_INTERVAL=60000

# =============================================================================
# PRODUCTION DEPLOYMENT VARIABLES
# =============================================================================

# Environment identifier
NODE_ENV=production
DEPLOYMENT_ENV=production

# AWS Configuration (for bare metal instances)
AWS_REGION=us-west-2
EC2_INSTANCE_TYPES=c5.metal,m6i.metal

# Container registry configuration
IMAGE_PULL_POLICY=Always
IMAGE_PULL_SECRETS=ecr-registry-secret

# =============================================================================
# ERROR HANDLING & RESILIENCE
# =============================================================================

# VM operation timeouts
VM_OPERATION_TIMEOUT=30000
VM_CONSOLE_TIMEOUT=10000

# Retry configuration
VM_MAX_RETRIES=3
VM_RETRY_DELAY=1000

# Circuit breaker configuration
VM_CIRCUIT_BREAKER_THRESHOLD=5
VM_CIRCUIT_BREAKER_TIMEOUT=60000

# Failure handling
AUTO_RESTART_FAILED_VMS=true
MAX_VM_RESTART_ATTEMPTS=3

# =============================================================================
# OPTIONAL: ADVANCED CONFIGURATION
# =============================================================================

# Custom VM configuration
# VM_CUSTOM_KERNEL_ARGS="console=ttyS0 reboot=k panic=1 pci=off custom=value"
# VM_CUSTOM_NETWORK_CONFIG=true
# VM_ENABLE_VSOCK=true

# Development overrides (remove in production)
# SKIP_VM_ISOLATION=false
# ENABLE_DEBUG_CONSOLE=false
# MOCK_VM_FAILURES=false

# LSP Server configuration
# TYPESCRIPT_LSP_ENABLED=true
# PYTHON_LSP_ENABLED=true
# LSP_MEMORY_LIMIT=512MB

# Git configuration
# GIT_COMMIT_AUTHOR="Shadow Agent <shadow@shadowcoding.ai>"
# GIT_AUTO_PUSH=true
# GIT_SHADOW_BRANCH_PREFIX=shadow/task-